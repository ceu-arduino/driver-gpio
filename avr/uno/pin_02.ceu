#include "gpio.ceu"

input high/low PIN_02;

native/const _INT0_vect;

{
    pinMode(2, INPUT_PULLUP);
    EICRA = (EICRA & ~((1<<ISC00) | (1<<ISC01))) | (CHANGE << ISC00);
    EIMSK |= (1<<INT0);
}

spawn async/isr [_INT0_vect] do
    var high/low v = _digitalRead(2) as high/low;
    emit PIN_IN(2, v);
    emit PIN_02(v);
end
