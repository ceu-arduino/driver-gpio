#include "gpio.ceu"

input high/low PIN_03;

native/const _INT1_vect;

{
    pinMode(3, INPUT_PULLUP);
    EICRA = (EICRA & ~((1<<ISC10) | (1<<ISC11))) | (CHANGE << ISC10);
    EIMSK |= (1<<INT1);
}

spawn async/isr [_INT1_vect] do
    var high/low v = _digitalRead(3) as high/low;
    emit PIN_IN(3, v);
    emit PIN_03(v);
end
